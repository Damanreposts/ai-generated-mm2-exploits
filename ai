-- Create the main screen GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MM2RoleFinderGUI"
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Create the main frame for the UI
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 200)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true -- Allow the main frame to be dragged

-- Add UICorner for rounded edges
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Helper function to create buttons
local function createButton(name, text, position, callback)
    local Button = Instance.new("TextButton")
    Button.Name = name
    Button.Text = text
    Button.Size = UDim2.new(0, 280, 0, 50)
    Button.Position = position
    Button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    Button.BorderColor3 = Color3.fromRGB(255, 0, 0)
    Button.Parent = MainFrame

    Button.MouseButton1Click:Connect(callback)
end

-- Function to find and announce the murderer
local murdererDetected = false
local murdererAnnounceConnection

local function toggleFindMurderer()
    murdererDetected = not murdererDetected
    if murdererDetected then
        murdererAnnounceConnection = game:GetService("RunService").Stepped:Connect(function()
            for _, player in pairs(game.Players:GetPlayers()) do
                if player.Backpack:FindFirstChild("Knife") or (player.Character and player.Character:FindFirstChild("Knife")) then
                    game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("The Murderer is: " .. player.Name, "All")
                    break
                end
            end
        end)
    else
        if murdererAnnounceConnection then
            murdererAnnounceConnection:Disconnect()
            murdererAnnounceConnection = nil
        end
    end
end

-- Function to find and announce the sheriff
local sheriffDetected = false
local sheriffAnnounceConnection

local function toggleFindSheriff()
    sheriffDetected = not sheriffDetected
    if sheriffDetected then
        sheriffAnnounceConnection = game:GetService("RunService").Stepped:Connect(function()
            for _, player in pairs(game.Players:GetPlayers()) do
                if player.Backpack:FindFirstChild("Gun") or (player.Character and player.Character:FindFirstChild("Gun")) then
                    game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("The Sheriff is: " .. player.Name, "All")
                    break
                end
            end
        end)
    else
        if sheriffAnnounceConnection then
            sheriffAnnounceConnection:Disconnect()
            sheriffAnnounceConnection = nil
        end
    end
end

-- Function to instantly find and announce your own role
local function findMyRole()
    local player = game.Players.LocalPlayer
    if player.Backpack:FindFirstChild("Knife") or (player.Character and player.Character:FindFirstChild("Knife")) then
        game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("My role is: Murderer", "All")
    elseif player.Backpack:FindFirstChild("Gun") or (player.Character and player.Character:FindFirstChild("Gun")) then
        game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("My role is: Sheriff", "All")
    else
        game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("My role is: Innocent", "All")
    end
end

-- Creating buttons with the specified actions
createButton("FindMurdererButton", "Find Murderer", UDim2.new(0, 10, 0, 10), toggleFindMurderer)
createButton("FindSheriffButton", "Find Sheriff", UDim2.new(0, 10, 0, 70), toggleFindSheriff)
createButton("FindRoleButton", "Find My Role", UDim2.new(0, 10, 0, 130), findMyRole)
